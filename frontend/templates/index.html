<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Prescription Intelligence - AI-Powered Prescription Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='design.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="#home" class="logo">OCR Prescription Intelligence</a>
        <ul class="nav-links">
            <li><a href="#home" class="nav-link active" data-section="home">Home</a></li>
            <li><a href="#upload" class="nav-link" data-section="upload">Analyze</a></li>
            <li><a href="#dashboard" class="nav-link" data-section="dashboard">Dashboard</a></li>
            <li><a href="#about" class="nav-link" data-section="about">About</a></li>
            <li><a href="#contact" class="nav-link" data-section="contact">Contact</a></li>
        </ul>
    </nav>

    <!-- ========================================================================
         HOME SECTION
    ======================================================================== -->
    <section id="home" class="page-section active">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <div class="hero-badge">
                    <span class="badge-pulse"></span>
                    <span>AI-Powered Medical Intelligence</span>
                </div>
                <h1 class="hero-title">Transform Prescriptions<br/>Into Actionable Intelligence</h1>
                <p class="hero-subtitle">
                    Next-generation AI that extracts, analyzes, and structures medical prescriptions
                    with unprecedented accuracy and speed.
                </p>
                <div class="hero-buttons">
                    <a href="#upload" class="btn-glow" onclick="navigateToSection('upload')">Start Analysis ‚Üí</a>
                    <a href="#dashboard" class="btn-outline" onclick="navigateToSection('dashboard')">View Dashboard</a>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="features-section">
            <div class="section-header">
                <h2>Powerful Features</h2>
                <p>Everything you need for intelligent prescription analysis</p>
            </div>

            <div class="features-grid">
                <div class="feature-card glass-card">
                    <div class="feature-icon">ü§ñ</div>
                    <h3>AI-Powered OCR</h3>
                    <p>Advanced AWS Textract technology extracts text from prescription images with 99%+ accuracy.</p>
                </div>

                <div class="feature-card glass-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Smart NER Processing</h3>
                    <p>Named Entity Recognition identifies medications, dosages, routes, and frequencies automatically.</p>
                </div>

                <div class="feature-card glass-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Real-Time Analysis</h3>
                    <p>Get instant results with our high-performance processing pipeline powered by machine learning.</p>
                </div>

                <div class="feature-card glass-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Structured Data</h3>
                    <p>Converts unstructured prescription text into organized, queryable medical data.</p>
                </div>

                <div class="feature-card glass-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Secure & Private</h3>
                    <p>HIPAA-compliant processing ensures your medical data remains confidential and secure.</p>
                </div>

                <div class="feature-card glass-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Analytics Dashboard</h3>
                    <p>Track processing history, view trends, and manage your prescription data efficiently.</p>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="how-it-works-section">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Simple 3-step process to digitize prescriptions</p>
            </div>

            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>Upload</h3>
                    <p>Upload prescription image or enter text manually through our intuitive interface.</p>
                </div>

                <div class="step-arrow">‚Üí</div>

                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Process</h3>
                    <p>Our AI analyzes the prescription using AWS Textract and advanced NER models.</p>
                </div>

                <div class="step-arrow">‚Üí</div>

                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>Extract</h3>
                    <p>Get structured data with medications, dosages, routes, and frequencies identified.</p>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card glass-card">
                    <div class="stat-number">99%+</div>
                    <div class="stat-label">Accuracy Rate</div>
                </div>

                <div class="stat-card glass-card">
                    <div class="stat-number">&lt;2s</div>
                    <div class="stat-label">Processing Time</div>
                </div>

                <div class="stat-card glass-card">
                    <div class="stat-number">10K+</div>
                    <div class="stat-label">Prescriptions Processed</div>
                </div>

                <div class="stat-card glass-card">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">Availability</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================================================================
         UPLOAD SECTION
    ======================================================================== -->
    <section id="upload" class="page-section">
        <div class="main-container">
            <div style="text-align: center; margin-bottom: 3rem;">
                <h1 style="font-size: 2.5rem; color: white;">Upload & Analyze Prescription</h1>
                <p>Choose your preferred method to process a prescription.</p>
            </div>

            <div class="dashboard-grid">
                <div class="glass-card">
                    <h2>Upload Image</h2>
                    <form id="imageForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <div class="upload-area" id="dropZone">
                                <span class="icon">üìÅ</span>
                                <p>Click to upload or drag & drop</p>
                            </div>
                            <input type="file" id="imageFile" name="file" style="display: none;">
                        </div>
                        <button type="submit" class="btn-glow" style="width: 100%;">Process Image</button>
                    </form>
                </div>

                <div class="glass-card">
                    <h2>Enter Text Manually</h2>
                    <form id="textForm">
                        <div class="form-group">
                            <textarea id="prescriptionText" name="prescriptionText" rows="6" placeholder="Enter prescription text here..."></textarea>
                        </div>
                        <button type="submit" class="btn-glow" style="width: 100%;">Process Text</button>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section" style="display: none; margin-top: 3rem;">
                <div class="glass-card">
                    <h2>Analysis Results</h2>

                    <div class="dashboard-grid">
                        <div class="result-card">
                            <h3>üíä Medications</h3>
                            <ul id="medications"></ul>
                        </div>

                        <div class="result-card">
                            <h3>üìä Dosages</h3>
                            <ul id="doses"></ul>
                        </div>

                        <div class="result-card">
                            <h3>üõ£Ô∏è Routes</h3>
                            <ul id="routes"></ul>
                        </div>

                        <div class="result-card">
                            <h3>‚è∞ Frequencies</h3>
                            <ul id="frequencies"></ul>
                        </div>
                    </div>

                    <div class="raw-text-section">
                        <h3>üìÑ Raw Extracted Text</h3>
                        <div class="raw-text" id="rawText"></div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="downloadResults()" class="btn-outline">üì• Download</button>
                        <button onclick="copyResults()" class="btn-outline">üìã Copy</button>
                        <button onclick="newAnalysis()" class="btn-glow">üîÑ New Analysis</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================================================================
         DASHBOARD SECTION
    ======================================================================== -->
    <section id="dashboard" class="page-section">
        <div class="main-container">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div>
                    <h1>System Dashboard</h1>
                    <p>Monitor your prescription analysis activity and system performance</p>
                </div>
                <a href="#upload" class="btn-glow" onclick="navigateToSection('upload')">New Analysis</a>
            </div>

            <!-- Stats Overview -->
            <div class="dashboard-grid">
                <div class="glass-card stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <h3 class="stat-number" id="totalProcessed">0</h3>
                        <p class="stat-label">Total Processed</p>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-content">
                        <h3 class="stat-number" id="todayAnalysis">0</h3>
                        <p class="stat-label">Today's Analysis</p>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3 class="stat-number" id="successRate">99.2%</h3>
                        <p class="stat-label">Success Rate</p>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-content">
                        <h3 class="stat-number" id="avgTime">1.8s</h3>
                        <p class="stat-label">Avg Processing Time</p>
                    </div>
                </div>
            </div>

            <!-- System Status Section -->
            <div class="dashboard-section">
                <h2>System Status</h2>

                <div class="status-grid">
                    <div class="glass-card status-card">
                        <div class="status-header">
                            <h3>Frontend Server</h3>
                            <span class="status-indicator online" id="frontendStatus"></span>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> <span id="frontendStatusText">Online</span></p>
                            <p><strong>Port:</strong> 3000</p>
                            <p><strong>Uptime:</strong> <span id="frontendUptime">--</span></p>
                        </div>
                    </div>

                    <div class="glass-card status-card">
                        <div class="status-header">
                            <h3>Backend API</h3>
                            <span class="status-indicator" id="backendStatus"></span>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> <span id="backendStatusText">Checking...</span></p>
                            <p><strong>Port:</strong> 5000</p>
                            <p><strong>Response Time:</strong> <span id="backendResponse">--</span></p>
                        </div>
                    </div>

                    <div class="glass-card status-card">
                        <div class="status-header">
                            <h3>NER Model</h3>
                            <span class="status-indicator" id="nerStatus"></span>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> <span id="nerStatusText">Checking...</span></p>
                            <p><strong>Model:</strong> BioBERT</p>
                            <p><strong>Accuracy:</strong> 99.2%</p>
                        </div>
                    </div>

                    <div class="glass-card status-card">
                        <div class="status-header">
                            <h3>AWS Textract</h3>
                            <span class="status-indicator" id="textractStatus"></span>
                        </div>
                        <div class="status-info">
                            <p><strong>Status:</strong> <span id="textractStatusText">Checking...</span></p>
                            <p><strong>Region:</strong> ap-south-1</p>
                            <p><strong>Credits:</strong> Available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========================================================================
         ABOUT SECTION
    ======================================================================== -->
    <section id="about" class="page-section">
        <div class="main-container">
            <div class="section-header" style="text-align: center; margin-bottom: 3rem;">
                <h1>About OCR Prescription Intelligence</h1>
                <p>AI-powered prescription digitization for modern healthcare</p>
            </div>

            <div class="about-content glass-card" style="padding: 3rem; margin-bottom: 3rem;">
                <h2>Our Mission</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                    Scan is revolutionizing healthcare documentation by transforming traditional prescription 
                    processing into an intelligent, automated system. Using cutting-edge AI and machine learning, 
                    we help healthcare professionals digitize, analyze, and manage prescription data with 
                    unprecedented accuracy and efficiency.
                </p>

                <h2>Technology Stack</h2>
                <div class="tech-stack" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                    <div class="tech-item">
                        <h3>ü§ñ AWS Textract</h3>
                        <p>Advanced OCR for prescription image processing</p>
                    </div>
                    <div class="tech-item">
                        <h3>üß† BioBERT NER</h3>
                        <p>Medical entity recognition and extraction</p>
                    </div>
                    <div class="tech-item">
                        <h3>üî• Flask API</h3>
                        <p>High-performance backend processing</p>
                    </div>
                    <div class="tech-item">
                        <h3>‚ö° Real-time Processing</h3>
                        <p>Instant results with cloud infrastructure</p>
                    </div>
                </div>

                <h2>Key Benefits</h2>
                <ul style="font-size: 1.1rem; line-height: 2; margin: 1.5rem 0;">
                    <li>‚úÖ 99%+ accuracy in prescription text extraction</li>
                    <li>‚úÖ Sub-2-second processing time</li>
                    <li>‚úÖ HIPAA-compliant security and privacy</li>
                    <li>‚úÖ Automated medication, dosage, and frequency identification</li>
                    <li>‚úÖ Structured data output for EHR integration</li>
                    <li>‚úÖ 24/7 availability with cloud scalability</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- ========================================================================
         CONTACT SECTION
    ======================================================================== -->
    <section id="contact" class="page-section">
        <div class="main-container">
            <div class="section-header" style="text-align: center; margin-bottom: 3rem;">
                <h1>Contact Us</h1>
                <p>Get in touch with our team</p>
            </div>

            <div class="contact-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div class="glass-card" style="padding: 2.5rem;">
                    <h2>Send us a Message</h2>
                    <form id="contactForm">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="contactName" placeholder="Your Name" required>
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="contactEmail" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label>Message</label>
                            <textarea id="contactMessage" rows="6" placeholder="Your message here..." required></textarea>
                        </div>

                        <button type="submit" class="btn-glow" style="width: 100%;">Send Message</button>
                    </form>
                </div>

                <div class="contact-info glass-card" style="padding: 2.5rem;">
                    <h2>Contact Information</h2>

                    <div class="contact-item" style="margin: 2rem 0;">
                        <h3>üìß Email</h3>
                        <p>support@ocr-prescription.ai</p>
                    </div>

                    <div class="contact-item" style="margin: 2rem 0;">
                        <h3>üìû Phone</h3>
                        <p>+1 (555) 123-4567</p>
                    </div>

                    <div class="contact-item" style="margin: 2rem 0;">
                        <h3>üìç Location</h3>
                        <p>123 AI Street<br>Tech City, TC 12345<br>United States</p>
                    </div>

                    <div class="contact-item" style="margin: 2rem 0;">
                        <h3>üïê Hours</h3>
                        <p>Monday - Friday: 9AM - 6PM<br>Saturday - Sunday: Closed</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 OCR Prescription Intelligence. All Rights Reserved.</p>
    </footer>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        // Single Page Application Navigation
        let currentResults = null;
        let startTime = Date.now();

        // Navigate to section
        function navigateToSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show target section
            document.getElementById(sectionId).classList.add('active');

            // Update nav active state
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Initialize section-specific functionality
            if (sectionId === 'dashboard') {
                checkSystemHealth();
                loadStats();
            }
        }

        // Nav link click handlers
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                navigateToSection(this.dataset.section);
            });
        });

        // File upload handling
        const dropZone = document.getElementById('dropZone');
        const imageFile = document.getElementById('imageFile');

        if (dropZone && imageFile) {
            dropZone.addEventListener('click', () => imageFile.click());

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    imageFile.files = e.dataTransfer.files;
                }
            });
        }

        // Image form submission
        document.getElementById('imageForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!imageFile.files.length) {
                alert('Please select a file');
                return;
            }

            const formData = new FormData();
            formData.append('file', imageFile.files[0]);

            try {
                const response = await fetch('/api/process-image', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    displayResults(data.data);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Text form submission
        document.getElementById('textForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const text = document.getElementById('prescriptionText').value.trim();
            if (!text) {
                alert('Please enter prescription text');
                return;
            }

            try {
                const response = await fetch('/api/process-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();

                if (data.success) {
                    displayResults(data.data);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Display results
        function displayResults(data) {
            currentResults = data;

            document.getElementById('medications').innerHTML = (data.medications && data.medications.length)
                ? data.medications.map(m => `<li>${m}</li>`).join('')
                : '<li>None detected</li>';

            document.getElementById('doses').innerHTML = (data.doses && data.doses.length)
                ? data.doses.map(d => `<li>${d}</li>`).join('')
                : '<li>None detected</li>';

            document.getElementById('routes').innerHTML = (data.routes && data.routes.length)
                ? data.routes.map(r => `<li>${r}</li>`).join('')
                : '<li>None detected</li>';

            document.getElementById('frequencies').innerHTML = (data.frequencies && data.frequencies.length)
                ? data.frequencies.map(f => `<li>${f}</li>`).join('')
                : '<li>None detected</li>';

            document.getElementById('rawText').textContent = data.raw_text || 'No text extracted';

            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Download results
        function downloadResults() {
            if (!currentResults) return;
            const blob = new Blob([JSON.stringify(currentResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prescription_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Copy results
        function copyResults() {
            if (!currentResults) return;
            navigator.clipboard.writeText(JSON.stringify(currentResults, null, 2))
                .then(() => alert('Results copied!'))
                .catch(() => alert('Failed to copy'));
        }

        // New analysis
        function newAnalysis() {
            document.getElementById('imageForm').reset();
            document.getElementById('textForm').reset();
            document.getElementById('resultsSection').style.display = 'none';
            currentResults = null;
        }

        // Check system health
        async function checkSystemHealth() {
            try {
                const startTime = Date.now();
                const response = await fetch('/api/health');
                const responseTime = Date.now() - startTime;
                const data = await response.json();

                document.getElementById('frontendStatusText').textContent = 'Online';
                document.getElementById('frontendStatus').className = 'status-indicator online';

                if (data.backend && data.backend.success) {
                    document.getElementById('backendStatusText').textContent = 'Online';
                    document.getElementById('backendStatus').className = 'status-indicator online';
                    document.getElementById('backendResponse').textContent = responseTime + 'ms';

                    if (data.backend.data && data.backend.data.components) {
                        const nerStatus = data.backend.data.components.ner_model;
                        document.getElementById('nerStatusText').textContent = 
                            nerStatus === 'initialized' ? 'Online' : 'Offline';
                        document.getElementById('nerStatus').className = 
                            nerStatus === 'initialized' ? 'status-indicator online' : 'status-indicator offline';

                        const textractStatus = data.backend.data.components.textract;
                        document.getElementById('textractStatusText').textContent = 
                            textractStatus === 'configured' ? 'Online' : 'Offline';
                        document.getElementById('textractStatus').className = 
                            textractStatus === 'configured' ? 'status-indicator online' : 'status-indicator offline';
                    }
                } else {
                    document.getElementById('backendStatusText').textContent = 'Offline';
                    document.getElementById('backendStatus').className = 'status-indicator offline';
                }
            } catch (error) {
                console.error('Health check failed:', error);
            }
        }

        // Update uptime
        function updateUptime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            const uptimeEl = document.getElementById('frontendUptime');
            if (uptimeEl) {
                uptimeEl.textContent = `${hours}h ${minutes}m ${seconds}s`;
            }
        }

        // Load stats
        function loadStats() {
            document.getElementById('totalProcessed').textContent = '1,234';
            document.getElementById('todayAnalysis').textContent = '47';
        }

        // Contact form submission
        document.getElementById('contactForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                message: document.getElementById('contactMessage').value
            };

            try {
                const response = await fetch('/api/contact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Message sent successfully!');
                    document.getElementById('contactForm').reset();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setInterval(updateUptime, 1000);
        });
    </script>
</body>
</html>